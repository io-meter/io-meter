<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>写个 Icon Font Viewer : 贰 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="这次我们先来做一些代码拆分，将窗口管理的代码从IFDocument当中剥离出来。随后将会实现Icon 的缩放功能。完整代码可以在这里找到。">
<meta property="og:type" content="article">
<meta property="og:title" content="写个 Icon Font Viewer : 贰">
<meta property="og:url" content="http://yoursite.com/2014/04/18/seperate-codes-and-zoom-icon/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="这次我们先来做一些代码拆分，将窗口管理的代码从IFDocument当中剥离出来。随后将会实现Icon 的缩放功能。完整代码可以在这里找到。">
<meta property="og:image" content="http://yoursite.com/img/iconfontr/IFDocumentWindowController.png">
<meta property="og:image" content="http://yoursite.com/img/iconfontr/set-files-owner.png">
<meta property="og:image" content="http://yoursite.com/img/iconfontr/outlets.png">
<meta property="og:image" content="http://yoursite.com/img/iconfontr/new-subclasses.png">
<meta property="og:image" content="http://yoursite.com/img/iconfontr/zoom-result.png">
<meta property="og:updated_time" content="2016-01-16T14:12:11.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="写个 Icon Font Viewer : 贰">
<meta name="twitter:description" content="这次我们先来做一些代码拆分，将窗口管理的代码从IFDocument当中剥离出来。随后将会实现Icon 的缩放功能。完整代码可以在这里找到。">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-seperate-codes-and-zoom-icon" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/04/18/seperate-codes-and-zoom-icon/" class="article-date">
  <time datetime="2014-04-18T15:21:46.000Z" itemprop="datePublished">2014-04-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/iconfontr/">iconfontr</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      写个 Icon Font Viewer : 贰
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这次我们先来做一些代码拆分，将窗口管理的代码从<code>IFDocument</code>当中剥离出来。随后将会实现<br>Icon 的缩放功能。<br>完整代码可以在<a href="https://github.com/shanzi/iconfontr/tree/R02_scale_and_color" target="_blank" rel="external">这里</a>找到。</p>
<a id="more"></a>
<p>这次的技术要点有：</p>
<ul>
<li>在<code>NSDocument</code>中切换为使用<code>WindowController</code>来管理窗体</li>
<li><code>NSScrollView</code> 的 ZOOM 功能的使用，以及<code>JNWCollectionView</code>缩放问题的处理</li>
<li>键盘事件的侦听</li>
</ul>
<h2 id="u5207_u6362_u5230_WindowController"><a href="#u5207_u6362_u5230_WindowController" class="headerlink" title="切换到 WindowController"></a>切换到 WindowController</h2><p>对于初学者来说，理解 Xcode 当中的UI设计器与程序代码的交互可能需要一点时间。Xcode 4<br>之前，现在的窗口设计器部分其实是独立于 Xcode 的一个应用，名叫<br>Interface Builder(<a href="/wikipedia.org/wiki/Interface_Builder">Wiki</a>，简称 IB)。<br>现在说起来可能有点不可思议，不过 IB 最初是的确是开发出来写 Lisp 的。</p>
<p><a href="/io-meter.com/2014/04/12/iconfontr-1/">上一篇文章</a>介绍了使用<code>NSDocument</code>来实现简单的<br>Icon Font 预览，当时窗口管理的代码是写在<code>IFDocument.m</code>当中的。 这样做有一个坏处，<br>如果窗口控制代码比较复杂，在<code>IFDocument.m</code>类当中的代码就会变得不好维护。<br>所以我们需要一个独立的<code>WindowController</code>来控制窗口。</p>
<p>在<code>File&gt;new&gt;Files..</code>菜单中选择新建一个 Objective-C Class，设置如下图所示</p>
<p><img src="/img/iconfontr/IFDocumentWindowController.png" alt="IFDocumentWindowController"></p>
<p>这里如果勾选 Also create XIB file for user interface 的话，Xcode 会自动帮你新建并设置好 XIB 文件。<br>我们想要复用原来的<code>IFDocument.xib</code>，因此取消勾选这个选项。</p>
<p>接下来重新调整 XIB 文件和代码关系，<code>IFDocument.m</code>中存在这么一个函数:</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSString</span> *)windowNibName</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">@"IFDocument"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个函数指定了当前的<code>IFDocument</code>类对应的 UI 设计文件(也就是<code>IFDocument.xib</code>)。<br>我们把这个函数删除掉以切断<code>IFDocument.m</code>与<code>IFDocument.xib</code>的关系。</p>
<p>将<code>IFDocument.xib</code>重命名为<code>IFDocumentWindow.xib</code>。点击进入设计器之后，我们先把这个 XIB<br>文件分配给刚刚新建立的<code>IFDocumentWindowController</code>。如下图所示，在左边一栏点选<code>File&#39;s Owner</code><br>后右边的参数面板中作如下调整:</p>
<p><img src="/img/iconfontr/set-files-owner.png" alt="Set File&#39;s Owner"></p>
<p>我们知道，在右边参数面板中的<code>Custom Class</code>选项，就是指定 IB 中的对象与代码中定义的类的对应关系的。<br>我们在这里改变了<code>File&#39;s Owner</code>对应的类，就相当于在这个 XIB 文件和之前建立的<br><code>IFDocumentWindowController</code>类之间建立了一个关系。</p>
<p>右键单击<code>File&#39;s Owner</code>弹出的浮动窗口里有一栏叫做 outlets。这些 outlets 就是在代码中定义的用以和 XIB 中对象对接的接口。<br>在此需确保<code>Window</code>这一栏已经和设计器中的窗口连接在一起了<br>(如果没有，从右边的圆点处，拖动到窗口上释放以绑定连接)。如下图所示。</p>
<p><img src="/img/iconfontr/outlets.png" alt="Outlets"></p>
<p>建立了连接之后，我们在<code>IFDocumentWindowController.m</code>当中就可以用<code>self.window</code>来获得 XIB 当中的窗口了，<br>这个接口是在<code>IFDocumentWindowController</code>的父类<code>NSWindowController</code>当中定义的。<br>我们在<code>IFDocumentWindowController.h</code>中用下面代码来添加一个新的接口。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">IFDocumentWindowController</span> : <span class="title">NSWindowController</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">assign</span>) <span class="keyword">IBOutlet</span> JNWCollectionView *collectionView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>注意，在对象的类型前有一个<code>IBOutlet</code>关键字，这个关键字就是声明这个指针可以绑定到 IB 中的一个对象<br>(IBOutlet 中的 IB 当然代表 Interface Builder 咯)。在代码中声明了 Outlet 之后，我们可以在 IB 中把 <code>collectionView</code><br>这个接口和 XIB 中的 collectionView 对象连接起来了。</p>
<p>最后我们还要让 WindowController 知道自己对应的 XIB 文件是谁，以便于在<br>初始化的时候加载进来。在<code>IFDocumentWindowController.m</code> 中添加如下一个函数:</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSString</span> *)windowNibName</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">@"IFDocumentWindow"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来清理一下原来的<code>IFDocument.m</code>并把窗口控制相关的代码迁移到<code>IFDocumentWindowController</code>当中。</p>
<p>怎么样把原来的<code>IFDocument</code>和新的 <code>IFDocumentWindowController</code> 联系起来呢？在<code>makeWindowControllers</code><br>函数中创建<code>IFDocumentWindowController</code>的一个实例并调用<code>addWindowController:</code>函数就可以了。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>) makeWindowControllers</span><br><span class="line">&#123;</span><br><span class="line">  IFDocumentWindowController *windowController = [[IFDocumentWindowController alloc] init];</span><br><span class="line">  [(IFDocumentWindowController *)windowController setGlyphPathes:_glyphPathes];</span><br><span class="line">  [<span class="keyword">self</span> addWindowController:windowController];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过上面的步骤，可以看出了 XIB 和代码配合的的几个要点：</p>
<ul>
<li>File’s Owner 的类将 XIB 和一个 Controller 联系起来</li>
<li>在代码中可以用 IBOutlet 来定义一个接口，在运行时这个接口将会指向 XIB 中的一个对象</li>
<li>在 Files’s Owner 对应的 Controller 可以通过一个函数来指定对应 XIB 文件的名字</li>
<li>之后的文章还会介绍使用 IBAction 关键字来接收一个事件回调</li>
</ul>
<h2 id="u5B9E_u73B0_u7F29_u653E_u529F_u80FD"><a href="#u5B9E_u73B0_u7F29_u653E_u529F_u80FD" class="headerlink" title="实现缩放功能"></a>实现缩放功能</h2><p>老实说，缩放功能的实现比预计的要麻烦很多。本来以为作为<code>NSScroller</code>子类的<code>JNWCollectionView</code><br>能够很方便的开启缩放功能，结果却因在缩放过程中其会对子视图进行排版而导致各种 Bug，<br>经过多次尝试，终于还是找到了一个解决方案。</p>
<p>在<code>JNWCollectionView</code>上实现缩放的要点主要有：</p>
<ul>
<li>在缩放进行时，必须要禁止<code>JNWCollectionViewLayout</code>更新 layout 布局，否则将会出现卡顿</li>
<li>缩放结束后要调整<code>JNWCollectionViewLayout</code>的<code>documentView</code>大小，否则将无法横向滚动</li>
<li>如果要显示横向滚动条，需要修改<code>JNWCollectionViewLayout</code>的<code>ScrollDirection</code></li>
</ul>
<p>首先创建几个子类：</p>
<p><img src="/img/iconfontr/new-subclasses.png" alt="New Subclasses"></p>
<p>其中<code>IFMagnifyCollectionView</code>是<code>JNWCollectionView</code>的子类，<code>IFCollectionGridLayout</code><br>是<code>JNWCollectionGridLayout</code>的子类。为了在缩放过程中禁止<code>IFCollectionGridLayout</code>刷新排版，<br>给他添加一个新的属性并重载 <code>shouldInvalidateLayoutForBoundsChange</code>方法，<br>此外还要复写<code>ScrollDirection</code>方法来显示横向滚动条：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JNWCollectionGridLayout.h</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#import <span class="title">"JNWCollectionViewGridLayout.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">IFCollectionGridLayout</span> : <span class="title">JNWCollectionViewGridLayout</span></span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) <span class="built_in">BOOL</span> allowsLiveLayout;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// JNWCollectionGridLayout.m</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">IFCollectionGridLayout</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)shouldInvalidateLayoutForBoundsChange:(<span class="built_in">CGRect</span>)newBounds</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Forbid layout update when zooming</span></span><br><span class="line">  <span class="comment">// _allowsLiveLayout will be set to NO when zooming</span></span><br><span class="line">  <span class="keyword">return</span> _allowsLiveLayout;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (JNWCollectionViewScrollDirection)scrollDirection</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// scroll in both vertical and horizontal direction</span></span><br><span class="line">  <span class="keyword">return</span> JNWCollectionViewScrollDirectionBoth;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><code>IFMagnifyCollectionView</code>的父类<code>NSScrollView</code>其实已经提供了缩放的支持，<br>所以并不需要自己捕捉多点触摸的事件。开启缩放功能使用下面的函数就可以了。最关键的一句就是<br><code>self.allowsMagnification=YES;</code>，代表着允许使用缩放。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)invokeMagnification</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">self</span><span class="variable">.allowsMagnification</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span><span class="variable">.allowsMagnification</span> = <span class="literal">YES</span>;  <span class="comment">// turn on magnification</span></span><br><span class="line">    <span class="keyword">self</span><span class="variable">.magnification</span> = <span class="number">1.0</span>;</span><br><span class="line">    <span class="keyword">self</span><span class="variable">.maxMagnification</span> = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">self</span><span class="variable">.minMagnification</span> = <span class="number">1.0</span>;</span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span></span><br><span class="line">                                             selector:<span class="keyword">@selector</span>(liveMagnifyWillStart:)</span><br><span class="line">                                                 name:<span class="built_in">NSScrollViewWillStartLiveMagnifyNotification</span></span><br><span class="line">                                               object:<span class="keyword">self</span>];</span><br><span class="line">    </span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span></span><br><span class="line">                                             selector:<span class="keyword">@selector</span>(liveMagnifyDidEnd:)</span><br><span class="line">                                                 name:<span class="built_in">NSScrollViewDidEndLiveMagnifyNotification</span></span><br><span class="line">                                               object:<span class="keyword">self</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在函数的最后用<code>NSNotificationCenter</code>添加了两个消息侦听，这两个消息分别在缩放开始和结束时发出。<br>侦听这两个消息的目的就是为了在缩放开始和结束的时候设定<code>IFCollectionGridLayout</code>的<code>allowsLiveLayout</code><br>属性，以实现在缩放时禁止重新布局的需求。</p>
<p><code>liveMagnifyWillStart:</code>和<code>liveMagnifyDidEnd:</code>这两个回调函数的内容这里就略去不表了，<br>具体实现看<br><a href="https://github.com/shanzi/iconfontr/blob/R02_scale_and_color/iconfontr/IFMagnifyCollectionView.m" target="_blank" rel="external">IFMagnifyCollectionView</a>。</p>
<p>接下来我们解决缩放后的滚动问题，不同于 iOS 上的<code>UIScrollView</code>，<code>NSScrollView</code>没有<code>contentSize</code>属性。<br>实际上，<code>NSScrollView</code>包含一个子视图<code>documentView</code>，所有<code>NSScrollView</code>显示的 Subviews<br>都放置在<code>documentView</code>中。而<code>documentView</code>的<code>frame</code>属性指定了想要显示的内容的<em>完整</em>大小，<br><code>NSScrollView</code>的<code>documentVisbleRect</code>属性指定了想要内容<em>实际显示</em>的范围。</p>
<p>想要实现正确的滚动效果，就要正确的设置<code>documentView.frame</code>和<code>documentViewVisibleRect</code>两个属性。<br>在 Zoom 的过程中，<code>documentView</code>的大小其实是不变的，之所以我们可以看到内容被放大了，是因为对<br><code>documentView</code>发送了<code>scaleUnitSquareToSize:</code>消息，而<code>documentViewVisibleRect</code>也同时被缩小了。</p>
<p>现在的问题是，缩放结束之后<code>JNWCollectionView</code>会根据可视范围的大小重新调整<code>documentView</code>的大小，<br><code>documetView</code>的宽度将总是和<code>documventVisibleRect</code>一样，这样横向滚动就失效了。<br>一个最简单的解决方案是重载<code>documentVisibleRect</code>函数，不让它的宽度随着放大而相对变小。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSRect</span>)documentVisibleRect</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">NSRect</span> visibleRect = [<span class="keyword">super</span> documentVisibleRect];</span><br><span class="line">  visibleRect<span class="variable">.origin</span><span class="variable">.x</span> = <span class="number">0</span>;</span><br><span class="line">  visibleRect<span class="variable">.size</span><span class="variable">.width</span> *= <span class="keyword">self</span><span class="variable">.magnification</span>;</span><br><span class="line">  <span class="keyword">return</span> visibleRect;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样做牺牲了一定的性能，因为<code>JNWCollectionView</code>是根据<code>documentVisibleRect</code>来决定一个子视图是否可见，<br>据此移除看不见的 Subviews 并节约资源。最终还是是要修改<code>JNWCollectionView</code>的源码才能达到最好的效果，<br>这里也不详细介绍了。</p>
<p>为了方便使用，还可以添加键盘的事件侦听，只要设定<code>IFCollectionView</code>的<code>magnification</code>属性的大小就行了:</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#define kEqualsKeyCode 24</span></span><br><span class="line"><span class="preprocessor">#define kMinusKeyCode 27</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)keyDown:(<span class="built_in">NSEvent</span> *)theEvent</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// cancel the sound played after keydown</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)keyUp:(<span class="built_in">NSEvent</span> *)theEvent</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ([theEvent keyCode]==kEqualsKeyCode) &#123;</span><br><span class="line">    <span class="keyword">self</span><span class="variable">.magnification</span> += <span class="number">0.2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>([theEvent keyCode]==kMinusKeyCode) &#123;</span><br><span class="line">    <span class="keyword">self</span><span class="variable">.magnification</span> -= <span class="number">0.2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>想要捕捉键盘事件，只要重载<code>keyUp</code>、<code>keyDown</code>这样的函数就行了。包括鼠标、键盘和触摸事件在内的回调函数最初都定义在<br><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/ApplicationKit/Classes/NSResponder_Class/Reference/Reference.html" target="_blank" rel="external">NSResponder</a><br>中，在所有的<code>NSResponder</code>的子类中都可以使用。</p>
<p>对于键盘事件，<code>[theEvent keyCode]</code>返回的是一个设备无关的虚拟键值，符号<code>-</code>的值是<code>27</code>，符号<code>=</code>(也就是<code>+</code>所在的键)<br>的值是<code>24</code>。这里需要复写一下<code>keyDown</code>函数，避免按键时出现提示音。</p>
<p>现在就可以在触摸板上用 Spin 手势和键盘上的加减符号实现放大缩小了，效果如下图所示：</p>
<p><img src="/img/iconfontr/zoom-result.png" alt="Zoom Result"></p>
<h2 id="u4E00_u70B9_u603B_u7ED3_u548C_u9884_u544A"><a href="#u4E00_u70B9_u603B_u7ED3_u548C_u9884_u544A" class="headerlink" title="一点总结和预告"></a>一点总结和预告</h2><p>这次的文章主要记录了拆分代码和实现缩放的功能，其中详细介绍了 XIB 和代码之间的关系以及配合的问题，<br>感觉讲解的还不是很清楚，如果各位看官有什么问题，欢迎直接询问我。</p>
<p>在上面的结果图上可以看到其实已经实现了选择预览颜色的功能，不过限于篇幅原因还是决定留到下一篇文章再讲。<br>下次将会详细介绍一下如何编写一个自定义的 NSControl，附带图形绘制更详细的介绍以及用<code>IBAction</code><br>来实现事件的回调的方法。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2014/04/18/seperate-codes-and-zoom-icon/" data-id="cijh70nym003tqxr2ieo1u1mu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cocoa/">Cocoa</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Interface-Builder/">Interface Builder</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NSControl/">NSControl</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OSX/">OSX</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Objective-C/">Objective-C</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Xcode/">Xcode</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/icon-font/">icon font</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iconfontr/">iconfontr</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/04/22/review-of-pencil/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Pencil review and tips
        
      </div>
    </a>
  
  
    <a href="/2014/04/12/iconfontr-1/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">写个 Icon Font Viewer : 初</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Mastering-Paper/">Mastering Paper</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Math/">Math</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/essay/">essay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iconfontr/">iconfontr</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/osx/">osx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/review/">review</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Algorithm/">Algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Apple/">Apple</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bezier-Path/">Bezier Path</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cocoa/">Cocoa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Functional-Programing/">Functional Programing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GLSL/">GLSL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GSoC/">GSoC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go/">Go</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Interface-Builder/">Interface Builder</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NSControl/">NSControl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OSX/">OSX</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Objective-C/">Objective-C</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SVG/">SVG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swift/">Swift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Three-js/">Three.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Xcode/">Xcode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/accelerate-meter/">accelerate meter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bezier-path/">bezier path</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blender/">blender</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cocoa/">cocoa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/completion/">completion</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/contenteditable/">contenteditable</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/design/">design</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/desktop/">desktop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/develop/">develop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/device-motion/">device motion</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/distribute-storage/">distribute storage</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/drawing/">drawing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/editor/">editor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/export/">export</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/font/">font</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fontawesome/">fontawesome</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/">go</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/golang/">golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html/">html</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html5/">html5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS/">iOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS-8/">iOS 8</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iPad/">iPad</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/icon/">icon</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/icon-font/">icon font</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/icon-fontr/">icon fontr</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iconfontr/">iconfontr</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/image/">image</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/indexing/">indexing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/io-meter/">io-meter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ionicons/">ionicons</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/life/">life</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mac/">mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/math/">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mobile/">mobile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/online-editor/">online editor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/opensource/">opensource</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/osx/">osx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/package/">package</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/paper/">paper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pencil/">pencil</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/programing/">programing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rendering/">rendering</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/review/">review</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rpc/">rpc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/selection/">selection</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/server/">server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shader/">shader</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sketch/">sketch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stylus/">stylus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/summary/">summary</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/svg/">svg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swift/">swift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tips/">tips</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webGL/">webGL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webgl/">webgl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xcode/">xcode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zocial/">zocial</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/吐槽/">吐槽</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Algorithm/" style="font-size: 10px;">Algorithm</a> <a href="/tags/Apple/" style="font-size: 10px;">Apple</a> <a href="/tags/Bezier-Path/" style="font-size: 10px;">Bezier Path</a> <a href="/tags/Cocoa/" style="font-size: 10px;">Cocoa</a> <a href="/tags/Functional-Programing/" style="font-size: 10px;">Functional Programing</a> <a href="/tags/GLSL/" style="font-size: 10px;">GLSL</a> <a href="/tags/GSoC/" style="font-size: 10px;">GSoC</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/Go/" style="font-size: 13.33px;">Go</a> <a href="/tags/Interface-Builder/" style="font-size: 10px;">Interface Builder</a> <a href="/tags/NSControl/" style="font-size: 13.33px;">NSControl</a> <a href="/tags/OSX/" style="font-size: 16.67px;">OSX</a> <a href="/tags/Objective-C/" style="font-size: 13.33px;">Objective-C</a> <a href="/tags/SVG/" style="font-size: 10px;">SVG</a> <a href="/tags/Swift/" style="font-size: 10px;">Swift</a> <a href="/tags/Three-js/" style="font-size: 10px;">Three.js</a> <a href="/tags/Xcode/" style="font-size: 10px;">Xcode</a> <a href="/tags/accelerate-meter/" style="font-size: 10px;">accelerate meter</a> <a href="/tags/bezier-path/" style="font-size: 13.33px;">bezier path</a> <a href="/tags/blender/" style="font-size: 13.33px;">blender</a> <a href="/tags/cocoa/" style="font-size: 13.33px;">cocoa</a> <a href="/tags/completion/" style="font-size: 10px;">completion</a> <a href="/tags/contenteditable/" style="font-size: 10px;">contenteditable</a> <a href="/tags/design/" style="font-size: 10px;">design</a> <a href="/tags/desktop/" style="font-size: 10px;">desktop</a> <a href="/tags/develop/" style="font-size: 10px;">develop</a> <a href="/tags/device-motion/" style="font-size: 10px;">device motion</a> <a href="/tags/distribute-storage/" style="font-size: 10px;">distribute storage</a> <a href="/tags/drawing/" style="font-size: 20px;">drawing</a> <a href="/tags/editor/" style="font-size: 10px;">editor</a> <a href="/tags/export/" style="font-size: 10px;">export</a> <a href="/tags/font/" style="font-size: 13.33px;">font</a> <a href="/tags/fontawesome/" style="font-size: 10px;">fontawesome</a> <a href="/tags/go/" style="font-size: 10px;">go</a> <a href="/tags/golang/" style="font-size: 10px;">golang</a> <a href="/tags/html/" style="font-size: 10px;">html</a> <a href="/tags/html5/" style="font-size: 10px;">html5</a> <a href="/tags/iOS/" style="font-size: 10px;">iOS</a> <a href="/tags/iOS-8/" style="font-size: 10px;">iOS 8</a> <a href="/tags/iPad/" style="font-size: 16.67px;">iPad</a> <a href="/tags/icon/" style="font-size: 10px;">icon</a> <a href="/tags/icon-font/" style="font-size: 13.33px;">icon font</a> <a href="/tags/icon-fontr/" style="font-size: 10px;">icon fontr</a> <a href="/tags/iconfontr/" style="font-size: 16.67px;">iconfontr</a> <a href="/tags/image/" style="font-size: 10px;">image</a> <a href="/tags/indexing/" style="font-size: 10px;">indexing</a> <a href="/tags/io-meter/" style="font-size: 10px;">io-meter</a> <a href="/tags/ionicons/" style="font-size: 10px;">ionicons</a> <a href="/tags/life/" style="font-size: 10px;">life</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/mac/" style="font-size: 10px;">mac</a> <a href="/tags/math/" style="font-size: 10px;">math</a> <a href="/tags/mobile/" style="font-size: 10px;">mobile</a> <a href="/tags/online-editor/" style="font-size: 10px;">online editor</a> <a href="/tags/opensource/" style="font-size: 10px;">opensource</a> <a href="/tags/osx/" style="font-size: 13.33px;">osx</a> <a href="/tags/package/" style="font-size: 10px;">package</a> <a href="/tags/paper/" style="font-size: 13.33px;">paper</a> <a href="/tags/pencil/" style="font-size: 10px;">pencil</a> <a href="/tags/programing/" style="font-size: 10px;">programing</a> <a href="/tags/rendering/" style="font-size: 10px;">rendering</a> <a href="/tags/review/" style="font-size: 10px;">review</a> <a href="/tags/rpc/" style="font-size: 10px;">rpc</a> <a href="/tags/selection/" style="font-size: 10px;">selection</a> <a href="/tags/server/" style="font-size: 10px;">server</a> <a href="/tags/shader/" style="font-size: 10px;">shader</a> <a href="/tags/sketch/" style="font-size: 10px;">sketch</a> <a href="/tags/stylus/" style="font-size: 10px;">stylus</a> <a href="/tags/summary/" style="font-size: 10px;">summary</a> <a href="/tags/svg/" style="font-size: 10px;">svg</a> <a href="/tags/swift/" style="font-size: 10px;">swift</a> <a href="/tags/tips/" style="font-size: 10px;">tips</a> <a href="/tags/web/" style="font-size: 20px;">web</a> <a href="/tags/webGL/" style="font-size: 13.33px;">webGL</a> <a href="/tags/webgl/" style="font-size: 10px;">webgl</a> <a href="/tags/xcode/" style="font-size: 10px;">xcode</a> <a href="/tags/zocial/" style="font-size: 10px;">zocial</a> <a href="/tags/吐槽/" style="font-size: 10px;">吐槽</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">February 2014</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/05/04/recently-works/">最近的一点生活总结</a>
          </li>
        
          <li>
            <a href="/2014/12/31/sketch-rendering/">使用 WebGL 实现素描效果的渲染</a>
          </li>
        
          <li>
            <a href="/2014/10/24/develop-for-yosemite-some-tips/">Develop for Yosemite: 几个小技巧</a>
          </li>
        
          <li>
            <a href="/2014/10/03/when-webgl-meets-device-motion/">When WebGL Meets Device Motion</a>
          </li>
        
          <li>
            <a href="/2014/09/01/contenteditable-and-selection/">在线文本编辑器的基本实现原理</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>